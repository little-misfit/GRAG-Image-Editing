<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Group-Relative Attention Guidance Project Page (Split Components)</title>
  <style>
    :root {
      --bg: #ffffff;
      --card: #ffffff;
      --ink: #111111;
      --muted: #666666;
      --border: #ffffff;
      --radius: 16px;
      --sample-media-max-h: 220px; 
    }
    *{box-sizing:border-box}
    body { margin:0; padding:0; background:var(--bg); color:var(--ink); font:16px/1.6 -apple-system,BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial; }
    .container { max-width: 1120px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 40px; margin-bottom: 8px; font-weight: 800; }
    h2 { font-size: 28px; margin: 24px 0 16px; font-weight: 700; }
    h3 { font-size: 18px; margin: 0 0 8px; font-weight: 700; }
    .muted { color: var(--muted); }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: 0 1px 3px rgba(0,0,0,0.06); padding: 16px; }

    .intro-figure img { max-width: 800px; width: 100%; height: auto; display:block; margin: 0 auto; border-radius: 12px; }

    .grid3 { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 20px; }
    .sample { display:flex; flex-direction:column; gap:12px; }

 
    .sample .thumb img,
    .sample .compare img,
    .sample .preview img {
      max-width: 100%;
      height: auto;
      max-height: var(--sample-media-max-h);
      display: block;
      border-radius: 8px;
      -webkit-user-drag: none;
      user-select: none;
      pointer-events: none; 
    }

    .compare { width: 100%; border:1px solid var(--border); border-radius: 12px; position: relative; background:#f2f2f3; user-select:none; -webkit-user-select:none; touch-action:none; }
    .after-clip { position:absolute; inset:0; clip-path: inset(0 50% 0 0); }
    .handle-line { position:absolute; top:0; bottom:0; left:50%; width:1px; background:rgba(255, 255, 255, 0.6); box-shadow:0 0 0 1px rgba(0,0,0,.08); z-index: 1;}
    .handle-pill { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(255, 255, 255, 0.1); padding:1px 1px; border-radius:999px; border:1px solid var(--border); font-size:18px; box-shadow:0 2px 8px rgba(0,0,0,.08); z-index: 2;}
   
    .sample-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; align-items:start; }


    .slider { width:100%; }
    .ticks { display:flex; justify-content:space-between; font-size:11px; color:var(--muted); margin-top:6px; flex-wrap:wrap; gap:4px; }
    .ticks div.active { color: var(--ink); font-weight:600; }
    .pill { display:inline-flex; align-items:center; border:1px solid var(--border); background:#fff; padding:3px 8px; border-radius:999px; font-size:12px; }


    .badges { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .badge-img img { height: 20px; display:block; }
    @media (min-width: 980px){ .badges { margin-top: 10px; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Group-Relative Attention Guidance for Image Editing</h1>
    <p class="muted"><a href="https://little-misfit.github.io/">Xuanpu Zhang</a>, <a href="https://nxsedson.github.io/">Xuesong Niu</a>, <a href="https://littlefatshiba.github.io/">Ruidong Chen</a>, <a href="https://scholar.google.com/citations?user=G-mHRrEAAAAJ&hl=zh-CN">Dan Song</a>, <a href="https://zengjianhao.github.io/">Jianhao Zeng</a>, Penghui Du, Haoxiang Cao, Kai Wu, An-an Liu.</p>

    <!-- Badges container -->
    <div class="badges">
      <a class="badge-img" href="https://arxiv.org/abs/2510.24657" target="_blank" rel="noopener" aria-label="View on arXiv">
        <img alt="arXiv" src="https://img.shields.io/badge/arXiv-2301.01234-b31b1b?logo=arxiv&logoColor=white" />
      </a>
      <a class="badge-img" href="https://github.com/little-misfit/GRAG-Image-Editing" target="_blank" rel="noopener" aria-label="Open on Hugging Face">
        <img alt="Hugging Face" src="https://img.shields.io/badge/HuggingFace-Space-ffd21e?logo=huggingface&logoColor=black" />
      </a>
      <a class="badge-img" href="https://github.com/little-misfit/GRAG-Image-Editing" target="_blank" rel="noopener" aria-label="GitHub repository">
        <img alt="GitHub" src="https://img.shields.io/badge/GitHub-Code-111111?logo=github&logoColor=white" />
      </a>
    </div>

    <div class="card intro-figure">
      <img src="assets/main.jpg" alt="Principle diagram" loading="lazy">
    </div>

    <h2>Abstract</h2>
    <p class="muted">Recently, image editing based on Diffusion-in-Transformer (DiT) models has undergone rapid development. However, existing editing methods often lack effective control over the degree of editing, limiting their ability to achieve more customized results. To address this limitation, we investigate the MM-Attention mechanism within the DiT model and observe that the Query (Q) and Key (K) tokens share a bias vector that is only layer-dependent. We interpret this bias as representing the model's inherent editing behavior, while the delta between each token and its corresponding bias encodes the content-specific editing signals. Based on this insight, we propose Group Relative Attention Guidance (GRAG), a simple yet effective method that reweights the delta values of different tokens to modulate the focus of the model on the input image relative to the editing instruction, enabling continuous and fine-grained control over editing intensity without any tuning. Extensive experiments conducted on existing image editing frameworks demonstrate that GRAG can be integrated with as few as four lines of code, consistently enhancing editing quality. Moreover, compared to the commonly used Classifier-Free Guidance, GRAG achieves smoother and more precise control over the degree of editing.</p>

    <div class="card intro-figure">
      <img src="assets/intro.jpg" alt="Principle diagram" loading="lazy">
    </div>

    <h2>Method</h2>
    <p class="muted">The variations between individual token embeddings and the bias vector reflect how the editing content relates to the current layer's editing action. By modulating their relative relationship, it becomes possible to achieve accurate and continuous control over the editing instructions. Based on this insight, we propose Group Relative Attention Guidance (GRAG). As illustrated in the blow, we modify the cross-attention component of the MM-Attention corresponding to the query Q<sub>e</sub>. K<sub>s</sub> is selected as a group of tokens, to which group-relative modulation is applied. An illustration of applying Group Relative Attention Guidance in the MM-DiT image editing model.</p>

    <div class="card intro-figure">
      <img src="assets/method.jpg" alt="Principle diagram" loading="lazy">
    </div>

    <h2>Results</h2>
    <h3>Baseline+GRAG</h3>
    <div id="compare-only" class="grid3"></div>

    <h3 style="margin-top:24px">Continue Editing</h3>
    <div id="strength-only" class="grid3"></div>
  </div>

  <script>

    const Comparsion_SAMPLES = [
      {
        id: 'step1x-1',
        title: 'Step1X-Edit: Change Material',
        original: 'assets/samples/step1x-edit/000000000020.jpg',
        instruction: 'Turn the real birds to origami birds.',
        before: 'assets/samples/step1x-edit/000000000020+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/step1x-edit/000000000020-step1x.jpg' },
        ],
      },
      {
        id: 'step1x-2',
        title: 'Step1X-Edit: Change Content',
        original: 'assets/samples/step1x-edit/000000000001.jpg',
        instruction: 'Change the cake shape to square.',
        before: 'assets/samples/step1x-edit/000000000001+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/step1x-edit/000000000001-step1x.jpg' },
        ],
      },
      {
        id: 'step1x-3',
        title: 'Step1X-Edit: Change Object',
        original: 'assets/samples/step1x-edit/000000000056.jpg',
        instruction: 'Replace the meerkat with a lion.',
        before: 'assets/samples/step1x-edit/000000000056+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/step1x-edit/000000000056-step1x.jpg' },
        ],
      },
      
      {
        id: 'qwen-1',
        title: 'Qwen-Edit: Change Objects',
        original: 'assets/samples/qwen-edit/000000000113.jpg',
        instruction: 'Replace the dogs with rabbits.',
        before: 'assets/samples/qwen-edit/000000000113+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/qwen-edit/000000000113-qwen.jpg' },
        ],
      },
      {
        id: 'qwen-2',
        title: 'Qwen-Edit: Change Color',
        original: 'assets/samples/qwen-edit/000000000060.jpg',
        instruction: 'Change color of apple from yellow to red.',
        before: 'assets/samples/qwen-edit/000000000060+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/qwen-edit/000000000060-qwen.jpg' },
        ],
      },
      {
        id: 'qwen-3',
        title: 'Qwen-Edit: Change Object',
        original: 'assets/samples/qwen-edit/000000000019.jpg',
        instruction: 'Change the animal from tiger to cat.',
        before: 'assets/samples/qwen-edit/000000000019+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/qwen-edit/000000000019-qwen.jpg' },
        ],
      },

      {
        id: 'kontext-1',
        title: 'Kontext-Dev: Add Object',
        original: 'assets/samples/kontext/723000000001.jpg',
        instruction: 'Add a plastic bowl to the table.',
        before: 'assets/samples/kontext/723000000001+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/kontext/723000000001-kontext.jpg' },
        ],
      },
      {
        id: 'kontext-2',
        title: 'Kontext-Dev: Change Style',
        original: 'assets/samples/kontext/911000000005.jpg',
        instruction: 'Change watercolor painting to digital art.',
        before: 'assets/samples/kontext/911000000005+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/kontext/911000000005-kontext.jpg' },
        ],
      },
      {
        id: 'kontext-3',
        title: 'Kontext-Dev: Change Pose',
        original: 'assets/samples/kontext/522000000000.jpg',
        instruction: "Make the man's arms cross.",
        before: 'assets/samples/kontext/522000000000+grag.jpg',
        guidanceVariants: [
          { label: '', src: 'assets/samples/kontext/522000000000-kontext.jpg' },
        ],
      },
    ];
    const Slider_SAMPLES = [
      {
        id: 's1',
        title: 'Change Color',
        original: 'assets/samples/flower/000000000031.jpg',
        instruction: 'Change color of rose from red to blue.',
        guidanceVariants: [
          { label: '', src: 'assets/samples/flower/000000000031_1.24.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.22.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.20.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.18.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.16.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.14.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.12.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.10.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.08.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.06.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.04.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_1.02.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_0.98.jpg' },
          { label: '', src: 'assets/samples/flower/000000000031_0.96.jpg' },
        ],
      },
      {
        id: 's2',
        title: 'Change Object',
        original: 'assets/samples/flower_car/000000000022.jpg',
        instruction: 'Replace the surfboards with flowers.',
        guidanceVariants: [
          { label: '', src: 'assets/samples/flower_car/000000000022_1.24.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.22.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.20.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.18.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.16.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.14.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.12.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.10.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.08.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.06.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.04.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_1.02.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_0.98.jpg' },
          { label: '', src: 'assets/samples/flower_car/000000000022_0.96.jpg' },
        ],
      },
      {
        id: 's3',
        title: 'Change Material',
        original: 'assets/samples/yellowbird/000000000026.jpg',
        instruction: 'Turn the real bird to crochet bird.',
        guidanceVariants: [
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.24.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.22.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.20.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.18.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.16.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.14.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.12.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.10.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.08.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.06.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.04.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_1.02.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_0.98.jpg' },
          { label: '', src: 'assets/samples/yellowbird/000000000026_0.96.jpg' },
        ],
      },


      {
        id: 's4',
        title: 'Change Object',
        original: 'assets/samples/fire/000000000036.jpg',
        instruction: 'Change smoke to fire.',
        guidanceVariants: [
          { label: '', src: 'assets/samples/fire/000000000036_1.32.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.30.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.28.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.26.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.24.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.22.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.20.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.18.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.16.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.14.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.12.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.10.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.08.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.06.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.04.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_1.02.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_0.98.jpg' },
          { label: '', src: 'assets/samples/fire/000000000036_0.96.jpg' },
        ],
      },
      {
        id: 's5',
        title: 'Change Color',
        original: 'assets/samples/red_bird/000000000011.jpg',
        instruction: 'Change the color of the bird to red.',
        guidanceVariants: [
          { label: '', src: 'assets/samples/red_bird/000000000011_1.32.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.30.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.28.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.26.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.24.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.22.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.20.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.18.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.16.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.14.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.12.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.10.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.08.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.06.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.04.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_1.02.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_0.98.jpg' },
          { label: '', src: 'assets/samples/red_bird/000000000011_0.96.jpg' },
        ],
      },
      {
        id: 's6',
        title: 'Change Material',
        original: 'assets/samples/silver_cat/000000000004.jpg',
        instruction: 'Change cat from real to silver sculpture.',
        guidanceVariants: [
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.24.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.22.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.20.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.18.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.16.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.14.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.12.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.10.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.08.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.06.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.04.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_1.02.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_0.98.jpg' },
          { label: '', src: 'assets/samples/silver_cat/000000000004_0.96.jpg' },
        ],
      },
    ];


    const clamp=(v,lo,hi)=>Math.max(lo,Math.min(hi,v));
    const el=(tag,cls,html)=>{const n=document.createElement(tag); if(cls) n.className=cls; if(html!=null) n.innerHTML=html; return n;};


    class CompareViewer {
      /**
       * @param {string} beforeSrc - before
       * @param {string} afterSrc - after 
       */
      constructor(beforeSrc, afterSrc){
        this.ratio = 0.5; // 0..1
        this.root = el('div','compare');

        const before = new Image();
        before.src = beforeSrc; before.alt='Before'; before.loading='lazy'; before.draggable=false;

        this.afterWrap = el('div','after-clip');
        this.after = new Image();
        this.after.src = afterSrc; this.after.alt='After'; this.after.loading='lazy'; this.after.draggable=false;
        this.afterWrap.appendChild(this.after);

        this.line = el('div','handle-line');
        this.pill = el('div','handle-pill'); this.pill.textContent='👈';

        this.root.append(before, this.afterWrap, this.line, this.pill);
        this._bind();
        this._render();
      }

      _bind(){
        this.root.addEventListener('dragstart', (e)=> e.preventDefault());
        this.root.addEventListener('mousedown', (e)=> e.preventDefault());

        let dragging=false, pid=null;
        const setFromX=(clientX)=>{ const r=this.root.getBoundingClientRect(); const x=clientX - r.left; this.setRatio(x/r.width); };

        this.root.addEventListener('pointerdown',(e)=>{ e.preventDefault(); dragging=true; pid=e.pointerId; this.root.setPointerCapture?.(e.pointerId); setFromX(e.clientX);});
        this.root.addEventListener('pointermove',(e)=>{ if(!dragging) return; setFromX(e.clientX); });
        window.addEventListener('pointerup',(e)=>{ if(dragging && e.pointerId===pid){ dragging=false; this.root.releasePointerCapture?.(e.pointerId); } });

        this.root.setAttribute('tabindex','0');
        this.root.addEventListener('keydown',e=>{ if(e.key==='ArrowLeft'){ this.setRatio(this.ratio-0.02); } if(e.key==='ArrowRight'){ this.setRatio(this.ratio+0.02); } });
      }

      _render(){
        const pct=clamp(this.ratio*100,0,100);
        this.afterWrap.style.clipPath=`inset(0 ${clamp(100-pct,0,100)}% 0 0)`;
        this.line.style.left=pct+'%';
        this.pill.style.left=pct+'%';
      }

      /**  [0,1] */
      setRatio(v){ this.ratio = clamp(v,0,1); this._render(); this._emit('ratiochange', this.ratio); }
      /** After */
      setAfter(src){ this.after.src=src; this._emit('aftersrcchange', src); }

      on(type,handler){ (this._events||(this._events={}))[type]=(this._events[type]||[]); this._events[type].push(handler); return ()=>this.off(type,handler); }
      off(type,handler){ if(!this._events||!this._events[type]) return; this._events[type]=this._events[type].filter(h=>h!==handler); }
      _emit(type,payload){ if(!this._events||!this._events[type]) return; this._events[type].forEach(h=>{ try{ h(payload); }catch{} }); }
    }


    class StrengthSlider {
      /**
       * @param {{label:string, src:string}[]} variants - 
       * @param {number} initialIndex - 
       */
      constructor(variants, initialIndex=0){
        this.variants = variants || [];
        this.index = clamp(initialIndex, 0, Math.max(0, this.variants.length-1));

        this.root = el('div');
        const label=el('div','muted','Guidance Strength');
        this.slider=document.createElement('input'); this.slider.type='range'; this.slider.className='slider';
        this.slider.min=0; this.slider.max=String(Math.max(0,this.variants.length-1)); this.slider.step=1; this.slider.value=String(this.index);
        this.ticks=el('div','ticks');
        this.variants.forEach((v,i)=>{const t=el('div',i===this.index?'active':'',v.label); t.dataset.idx=String(i); this.ticks.appendChild(t);});
        // this.root.append(label, this.slider, this.ticks);
        this.root.append(label, this.slider);

        this._bind();
      }

      _bind(){
        this.slider.addEventListener('input',()=>{ this.setIndex(parseInt(this.slider.value,10)); });
        this.ticks.addEventListener('click',(e)=>{
          const t=e.target; if(!(t instanceof HTMLElement)) return; const i=t.dataset?.idx; if(i==null) return; this.setIndex(parseInt(i,10));
        });
      }

      setIndex(i){
        const ni=clamp(i,0,Math.max(0,this.variants.length-1));
        if(ni===this.index) return;
        this.index=ni; this.slider.value=String(this.index);
        [...this.ticks.children].forEach((c,ci)=>{ c.classList.toggle('active', ci===this.index); });
        const cur=this.variants[this.index];
        this._emit('change', { index:this.index, variant:cur });
      }

      on(type,handler){ (this._events||(this._events={}))[type]=(this._events[type]||[]); this._events[type].push(handler); return ()=>this.off(type,handler); }
      off(type,handler){ if(!this._events||!this._events[type]) return; this._events[type]=this._events[type].filter(h=>h!==handler); }
      _emit(type,payload){ if(!this._events||!this._events[type]) return; this._events[type].forEach(h=>{ try{ h(payload); }catch{} }); }
    }


    function makeCompareOnlyCard(s){
      const card=el('div','card sample');
      const header=el('div',null,`<h3>${s.title}</h3><p class="muted" style="margin-top:6px">${s.instruction}</p>`);
      const grid=el('div','sample-grid');
      const left=el('div','thumb'); left.innerHTML=`<img src="${s.original}" alt="Original" loading="lazy" draggable="false">`;
      const cmp = new CompareViewer(s.before, (s.guidanceVariants[0]?.src || s.before));
      grid.append(left, cmp.root);
      card.append(header, grid);
      return card;
    }


    function makeStrengthOnlyCard(s){
      const card=el('div','card sample');
      const header=el('div',null,`<h3>${s.title}</h3><p class=\"muted\" style=\"margin-top:6px\">${s.instruction}</p>`);
      const grid=el('div','sample-grid');
      const left=el('div','thumb'); left.innerHTML=`<img src="${s.original}" alt="Original" loading="lazy" draggable="false">`;
      const right=el('div','preview');
      const previewImg=new Image();
      previewImg.alt='Preview'; previewImg.loading='lazy'; previewImg.draggable=false;
      previewImg.src = s.guidanceVariants[0]?.src || s.before;
      right.appendChild(previewImg);

      const slider = new StrengthSlider(s.guidanceVariants, 0);
      slider.on('change', ({variant})=>{ if(variant?.src) previewImg.src = variant.src; });

      grid.append(left, right);
      card.append(header, grid, slider.root);
      return card;
    }


    (function init(){
      const mountCompare=document.getElementById('compare-only');
      const mountStrength=document.getElementById('strength-only');
      Comparsion_SAMPLES.forEach(s=>mountCompare.appendChild(makeCompareOnlyCard(s)));
      Slider_SAMPLES.forEach(s=>mountStrength.appendChild(makeStrengthOnlyCard(s)));
    })();
  </script>
</body>
<footer style="margin-top:60px; padding:20px 0; border-top:1px solid #eee; text-align:center; font-size:14px; color:#666;">
  <p><strong>Citation</strong></p>
  <pre style="text-align:left; display:inline-block; background:#f9f9f9; padding:10px 16px; border-radius:8px; font-size:13px; line-height:1.5;">
@article{zhang2025grag,
  title={Group-Relative Attention Guidance for Image Editing},
  author={Zhang, Xuanpu and Li, Second and Wang, Third},
  journal={Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)},
  year={2025}
}
  </pre>
  <p>© 2025 Group-Relative Attention Guidance Authors</p>
</footer>

</html>
